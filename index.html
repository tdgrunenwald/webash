<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8"/>
		<title>terminal.js</title>
		<script src="terminal.js"></script>
		<style>
			body {
				background: black;
				margin: 0px;
			}
		</style>
	</head>
	<body>
		<script>
			const HOME = "/home/guest"
			const dirs = new Object()
			dirs[HOME] = ["about", "resume"]
			dirs[HOME + "/projects"] = ["website"]
			dirs[HOME + "/projects/github"] = []

			var CWD = HOME // current working directory

			// create terminal
			var term = new Terminal()
			document.body.appendChild(term.html)

			// handle input
			function processInput(input) {
				if (input) {
					argv = input.split(" ")
					switch (argv[0]) {
						case "echo":
							term.print(input.replace(argv[0], "").trim().replace(/\"/g, ""))
							break;
						case "clear":
							term.clear()
							break;
						case "ls":
							ls()
							break;
						case "cd":
							cd(argv[1])
							break;
						case "pwd":
							term.print(CWD)
							break;
						default:
							term.print("-bash: " + argv[0] + ": command not	found")
					}
				}
				term.input(ps1(), processInput)
			}


			function ls() {
				let newListing = document.createElement('div')

				files = dirs[CWD]
				for (x in files) {
					let span = document.createElement('span')
					span.textContent = files[x]
					span.style.marginRight = "20px"
					span.style.color = "lightblue"
					newListing.appendChild(span)
				}

				subDirs = getSubDirs()
				for (x in subDirs) {
					let span = document.createElement('span')
					span.textContent = subDirs[x]
					span.style.marginRight = "20px"
					span.style.color = "blue"
					newListing.appendChild(span)
				}

				term._output.appendChild(newListing)
			}

			function cd(dir) {
				if (!dir || dir === "~" || dir === "") {
					CWD = HOME
				} else if (getSubDirs().includes(dir)) {
					CWD = CWD + "/" + dir
				}
			}

			function ps1() {
				return "guest@tylergrunenwald.com " + CWD.replace(HOME, "~") + " $ "
			}

			function getSubDirs() {
				let subDirs = []
				Object.keys(dirs).forEach((key) => { 
					let regex = new RegExp(CWD + "/([^/]+)/?.*")
					let match = regex.exec(key)
					if (match && !subDirs.includes(match[1])) subDirs.push(match[1]) 
				})
				return subDirs
			}

			// show initial prompt
			term.input(ps1(), processInput)
		</script>
	</body>
</html>
